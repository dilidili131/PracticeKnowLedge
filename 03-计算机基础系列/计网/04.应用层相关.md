# 应用层相关

## 1.客户端发送给服务器的请求，怎么确定具体的协议？

​		客户端发送给服务器端的请求，可以根据统一资源定位系统（Uniform Resource Locator，URL）来确定具体使用的协议。

​		一个完整的URL包括–协议部分、网址、文件地址部分。协议部分以//为分隔符，在Internet中，我们可以使用多种协议：

- HTTP——HyperText Transfer Protocol（超文本传输协议）

- FTP——File Transfer Protocol（文件传输协议）

- Gopher——The Internet Gopher Protocol(网际Gopher协议)

- File——本地文件传输协议

- HTTPS——安全套接字层超文本传输协议(http的安全版)

> **例如**百度网址：[http://baidu.com](http://baidu.com/)，可以看出使用的是http协议。

## 2. HTTP协议原理

> ​		HTTP 是一个**无状态**的协议，无状态指在客户端（ Web 浏览器） 和服务器之间不需要建立持久的连接，在一个客户端向服务器端发出请求且服务器收到该请求并返回响应( response ）后， 本次通信结束， HTTP 连接将被关闭，服务器不保留连接的相关信息。

> ​		HTTP 遵循请求（Request ）／应答（ Response ）模型，客户端向服务器发送请求，服务器处理请求并返回适当的应答。

### 2.1 特性

Http协议一共有五大特点：

- 支持客户/服务器模式
- 简单快捷
- 灵活
- **无连接**：限制每次连接只能处理一个请求。服务器处理完客户的请求，并收到客户的应答后，即断开连接，可以节省传输时间
- **无状态：**指协议对于事务处理没有记忆能力，服务器不知道客户端是什么状态。即我们给服务器发送 HTTP 请求之后，服务器根据请求，会给我们发送数据过来，但是，发送完，不会记录任何信息。

### 2.2 HTTP 客户机及服务器

- HTTP 客户机：web 浏览器

- HTTP 服务器：web 服务器，包含 web 对象（HTML 文件、JPEG 文件、java 小程序、视频片段等）

### 2.3HTTP的传输流程

​		HTTP 的传输流程包括**地址解析**、**封装HTTP 数据包**、**封装TCP 包**、**建立TCP 连接**、**客户端发送请求**、**服务端响应**、**服务端关闭TCP 连接**，具体流程如下。

​		(1)地址解析：地址解析通过**域名系统DNS**解析服务器域名从而获得主机的IP地址。例如，用客户端的浏览器请求http://localhost.com:8080/index.htm 则可从中分解出协议名、主机名、端口、对象路径等部分结果如下。

- 协议名：HTTP
- 主机名：localhost.com
- 端口：8080
- 对象路径：/index.html

​		(2)封装HTTP数据包：解析协议名、主机号、端口、对象路径等并结合本机自己的信息封装成一个HTTP请求数据包。

​		(3)封装TCP 包： 将HTTP 请求数据包进一步封装成TCP 数据包。

​		(4)建立TCP 连接： 基于TCP 的三次握手机制建立TCP 连接。

​		(5)客户端发送请求： 在建立连接后，客户端发送一个请求给服务器。

​		(6)服务器响应：服务器在接收到请求后，结合业务逻辑进行数据处理，然后向客户端返回相应的响应信息。在响应信息中包含**状态行**、协议版本号、**成功或错误的代码**、**消息体**等内容。

​		(7)服务器关闭TCP 连接： 服务器在向浏览器发送请求响应数据后关闭TCP 连接。但如果浏览器或者服务器在消息头中加入了Connection: keep-alive 则TCP 连接在请求响应数据发送后仍然保持连接状态，在下一次请求中浏览器可以继续使用相同的连接发送请求。**采用keep-alive 方式不但减少了请求响应的时间，还节约了网络带宽和系统资源。**

### 2.4 HTTP 方法字段：

- **GET**：绝大部分 HTTP 请求报文使用 GET 方法

- **POST**：用户提交表单时（如向搜索引擎提供关键字），但提交表单不一定要用 POST 方法

- **HEAD**：类似于 GET，**区别在于服务器返回的响应报文中不包含请求对象**（常用于故障跟踪）

-  **PUT**：用于向服务器上传对象

- **DELETE**：用于删除服务器上的对象

### 2.5 HTTP 常见状态码信息

| 状态码 | 原因短语             | 解释                                                         |
| ------ | -------------------- | ------------------------------------------------------------ |
| 200    | OK                   | 表示从客户端发来的请求在服务器端被正确处理                   |
| 301    | Permanently Moved    | 被请求的资源已永久移动到新位置，新的URL在Location头中给出，浏览器应该自动地访问新的URL |
| 302    | Found                | 请求的资源现在临时从不同的URL响应请求。301是永久重定向，而302是临时重定向 |
| 304    | Not Modified         | 304状态码是告诉浏览器可以从**缓存**中获取所请求的资源        |
| 400    | bad request          | 请求报文存在语法错误                                         |
| 403    | forbidden            | 表示对请求资源的访问被服务器拒绝                             |
| 404    | not found            | 表示在服务器上没有找到请求的资源                             |
| 500    | internal sever error | 表示服务器端在执行请求时发生了错误                           |
| 503    | service unavailable  | 表明服务器暂时处于超负载或正在停机维护，无法处理请求         |

## 3.文件传输协议FTP简介

FTP 使用**两个**并行的 TCP 连接来传输文件：

（1）**控制连接（持久）：**传输控制信息，如用户标识、口令、改变远程目录命令、文件获取上传的命令；

（2）**数据连接（非持久）：**传输实际文件。

​		FTP 客户机发起向 FTP 服务器的控制连接，然后在该连接上发送用户标识和口令、改变远程目录的命令。FTP服务器收到命令后，发起一个到客户机的数据连接，在该连接上准确地传送一个文件并关闭连接。

​		**有状态的协议**：FTP 服务器在整个会话期间保留用户的状态信息。服务器必须把特定的用户账号和控制连接联系起来。

## 4.应用层简介

​		应用层的具体内容就是规定应用进程在通信时所遵循的协议。应用层协议分类如下：

  (1). 域名系统(Domain Name System，DNS)：用于实现网络设备名字到IP地址映射的网络服务。

  (2). 文件传输协议(File Transfer Protocol，FTP)：用于实现交互式文件传输功能。

  (3). 简单邮件传送协议(Simple Mail Transfer Protocol, SMTP)：用于实现电子邮箱传送功能

  (4). 超文本传输协议(HyperText Transfer Protocol，HTTP)：用于实现WWW服务。

  (5). 简单网络管理协议(simple Network Management Protocol，SNMP)：用于管理与监视网络设备。

  (6). 远程登录协议(Telnet)：用于实现远程登录功能。

## 5. HTTPS

​		HTTPS是以安全为目标的HTTP通道，它在HTTP中加入SSL层以提高数据传输的安全性。HTTP被用于在Web浏览器和网站服务器之间传递信息，但以明文方式发送内容，不提供任何方式的数据加密，如果攻击者截取了Web 浏览器和网站服务器之间的传输报文，就可以直接读懂其中的信息，因此HTTP不适合传输一些敏感信息，比如身份证号码、密码等。为了数据传输的安全，HTTPS 在HTTP 的基础上加入了SSL协议，SSL依靠证书来验证服务器的身份，并对浏览器和服务器之间的通信进行数据加密，以保障数据传输的安全性，其端口一般是443。

​		HTTPS 的加密流程如下：

![](C:\Users\10852\Desktop\实习\img\计网\https.png)

​		1.发起请求： 客户端在通过TCP 和服务器建立连接之后（ 443端口），发出一个请求证书的消息给服务器，在该请求消息里包含自己可实现的算法列表和其他需要的消息。

​		2.证书返回：服务器端在收到消息后回应客户端并返回证书，在证书中包含**服务器信息、域名、申请证书的公司、公钥、数据加密算法等**。

​		3.证书验证： 客户端在收到证书后，判断证书签发机构是否正确，并使用该签发机构的公钥确认签名是否有效， 客户端还会确保在证书中列出的域名就是它正在连接的域名。如果客户端确认证书有效，则生成对称密钥，并使用公钥将对称密钥加密。
​		4.密钥交换： 客户端将加密后的对称密钥发送给服务器，服务器在接收到对称密钥后使用私钥解密。
​		5.数据传输： 经过上述步骤，客户端和服务器就完成了密钥对的交换， 在之后的数据传输过程中， 客户端和服务端就可以基于对称加密（ 加密和解密使用相同密钥的加

